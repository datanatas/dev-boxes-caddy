{
    # Local development settings
    auto_https off
    order layer4 first
}

# HTTP reverse proxy for Portainer UI via host: dckr.dev.local
http://dckr.dev.local {
    encode gzip
    @api path /api/*
    handle {
       reverse_proxy portainer:9000
    }
    log
}

# Layer4 (TCP) proxy for Postgres; requires caddy-l4 module
# This listens on :5432 and forwards to the db service.
# Clients can connect to pg.dev.local:5432
layer4 {
    # TCP listener for Postgres
    :5432 {
        route {
            proxy db:5432
        }
    }
}